Table users [headercolor: #47a6cc] {
	id uuid [ pk, unique ]
	email text [ not null ]
	family_name text
	created_at datetime [ default: "CURRENT_TIMESTAMP" ]
	updated_at datetime [ default: "CURRENT_TIMESTAMP" ]
}

Table ingredients [headercolor: #2ad42a] {
	id uuid [ pk, unique ]
	name text [ not null ]
	category_id integer
	default_unit text

	indexes {
		(category_id) [ name: 'ingredients_index_0' ]
	}
}

Table recipes [headercolor: #2ad42a] {
	id uuid [ pk, unique ]
	owner_user_id integer
	name text [ not null ]
	description text
	instructions text
	servings_default integer [ not null, default: 1 ]
	prep_minutes integer
	cook_minutes integer
	visibility recipe_visibility [ not null, default: "public" ]
	created_at datetime [ default: "CURRENT_TIMESTAMP" ]
	updated_at datetime [ default: "CURRENT_TIMESTAMP" ]

	indexes {
		(owner_user_id) [ name: 'recipes_index_1' ]
		(visibility) [ name: 'recipes_index_2' ]
		(name) [ name: 'recipes_index_3' ]
	}
}

Table recipe_ingredients [headercolor: #999e9e] {
	id uuid [ pk, unique ]
	recipe_id uuid [ not null ]
	ingredient_id integer [ not null ]
	quantity real
	unit text
	optional boolean [ default: false ]
	position integer

	indexes {
		(recipe_id) [ name: 'recipe_ingredients_index_4' ]
		(ingredient_id) [ name: 'recipe_ingredients_index_5' ]
		(recipe_id, ingredient_id) [ name: 'recipe_ingredients_index_6', unique ]
	}
}

Table user_saved_recipes [headercolor: #d5db16] {
	id uuid [ pk, unique ]
	user_id uuid [ not null ]
	recipe_id uuid [ not null ]
	custom_name text
	custom_servings integer
	pinned boolean [ default: false ]
	notes text
	created_at datetime [ default: "CURRENT_TIMESTAMP" ]

	indexes {
		(user_id) [ name: 'user_saved_recipes_index_7' ]
		(user_id, recipe_id) [ name: 'user_saved_recipes_index_8', unique ]
	}
}

Table categories [headercolor: #2ad42a] {
	id uuid [ pk, unique ]
	name text [ not null ]
}

Table user_ingredient_aliases [headercolor: #d5db16] {
	id uuid [ pk, unique ]
	user_id uuid [ not null ]
	ingredient_id integer [ not null ]
	alias text [ not null ]

	indexes {
		(user_id, alias) [ name: 'user_ingredient_aliases_index_9', unique ]
		(user_id, ingredient_id) [ name: 'user_ingredient_aliases_index_10', unique ]
	}
}

Table inventory_items [headercolor: #d5db16] {
	id uuid [ pk, unique ]
	user_id uuid [ not null ]
	ingredient_id integer [ not null ]
	quantity real [ not null ]
	unit text
	expires_at date
	is_active boolean [ default: true ]
	created_at datetime [ default: "CURRENT_TIMESTAMP" ]
	updated_at datetime [ default: "CURRENT_TIMESTAMP "]

	indexes {
		(user_id) [ name: 'inventory_items_index_11' ]
		(ingredient_id) [ name: 'inventory_items_index_12' ]
		(user_id, ingredient_id) [ name: 'inventory_items_index_13', unique ]
		(expires_at) [ name: 'inventory_items_index_14' ]
		(is_active) [ name: 'inventory_items_index_15' ]
	}
}

Table plan_entries [headercolor: #d5db16] {
	id uuid [ pk, unique ]
	user_id uuid [ not null ]
	date date [ not null ]
	meal meal_type [ not null ]
	recipe_id integer
	servings integer [ default: 1 ]
	notes text
	created_at datetime [ default: "CURRENT_TIMESTAMP" ]
	updated_at datetime [ default: "CURRENT_TIMESTAMP" ]

	indexes {
		(user_id) [ name: 'plan_entries_index_16' ]
		(user_id, date, meal) [ name: 'plan_entries_index_17', unique ]
		(recipe_id) [ name: 'plan_entries_index_18' ]
	}
}

Ref fk_categories_id_ingredients {
	categories.id < ingredients.category_id [ delete: no action, update: no action ]
}

Ref fk_users_id_recipes {
	users.id < recipes.owner_user_id [ delete: no action, update: no action ]
}

Ref fk_recipes_id_recipe_ingredients {
	recipes.id < recipe_ingredients.recipe_id [ delete: no action, update: no action ]
}

Ref fk_ingredients_id_recipe_ingredients {
	ingredients.id < recipe_ingredients.ingredient_id [ delete: no action, update: no action ]
}

Ref fk_users_id_user_saved_recipes {
	users.id < user_saved_recipes.user_id [ delete: no action, update: no action ]
}

Ref fk_recipes_id_user_saved_recipes {
	recipes.id < user_saved_recipes.recipe_id [ delete: no action, update: no action ]
}

Ref fk_users_id_user_ingredient_aliases {
	users.id < user_ingredient_aliases.user_id [ delete: no action, update: no action ]
}

Ref fk_ingredients_id_user_ingredient_aliases {
	ingredients.id < user_ingredient_aliases.ingredient_id [ delete: no action, update: no action ]
}

Ref fk_users_id_inventory_items {
	users.id < inventory_items.user_id [ delete: no action, update: no action ]
}

Ref fk_ingredients_id_inventory_items {
	ingredients.id < inventory_items.ingredient_id [ delete: no action, update: no action ]
}

Ref fk_users_id_plan_entries {
	users.id < plan_entries.user_id [ delete: no action, update: no action ]
}

Ref fk_recipes_id_plan_entries {
	recipes.id < plan_entries.recipe_id [ delete: no action, update: no action ]
}
